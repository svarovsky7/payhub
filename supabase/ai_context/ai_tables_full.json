[
  {
    "table": "public.approval_routes",
    "summary": "Payment approval routes. One invoice type can have multiple routes.",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "description": "Primary key"
      },
      {
        "name": "invoice_type_id",
        "type": "integer",
        "nullable": false,
        "description": "Invoice type ID this route applies to"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Route name"
      },
      {
        "name": "is_active",
        "type": "boolean",
        "nullable": true,
        "default": "true",
        "description": "Whether this route is currently active"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the route was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the route was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_20081_1_not_null"
        },
        {
          "name": "2200_20081_2_not_null"
        },
        {
          "name": "2200_20081_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_approval_routes_invoice_type",
        "columns": [
          "invoice_type_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_approval_routes_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.approval_steps",
    "summary": "Audit log of actions performed during payment approval process",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key"
      },
      {
        "name": "payment_approval_id",
        "type": "uuid",
        "nullable": false,
        "description": "Payment approval ID this step belongs to"
      },
      {
        "name": "stage_id",
        "type": "integer",
        "nullable": false,
        "description": "Workflow stage ID"
      },
      {
        "name": "action",
        "type": "text",
        "nullable": false,
        "description": "Action taken: approved, rejected, or returned"
      },
      {
        "name": "acted_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who performed the approval action"
      },
      {
        "name": "acted_at",
        "type": "timestamptz",
        "nullable": true,
        "description": "Timestamp when the action was performed"
      },
      {
        "name": "comment",
        "type": "text",
        "nullable": true,
        "description": "Optional comment explaining the decision"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the record was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "approval_steps_payment_approval_id_stage_id_key",
          "columns": [
            "payment_approval_id",
            "stage_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_20143_1_not_null"
        },
        {
          "name": "2200_20143_2_not_null"
        },
        {
          "name": "2200_20143_3_not_null"
        },
        {
          "name": "2200_20143_4_not_null"
        },
        {
          "name": "approval_steps_action_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "approval_steps_payment_approval_id_stage_id_key",
        "columns": [
          "payment_approval_id",
          "stage_id"
        ],
        "unique": false
      },
      {
        "name": "idx_approval_steps_acted_by",
        "columns": [
          "acted_by"
        ],
        "unique": false
      },
      {
        "name": "idx_approval_steps_approval",
        "columns": [
          "payment_approval_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "audit_approval_steps",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "UPDATE"
        ],
        "function": "public.log_approval_actions()"
      }
    ]
  },
  {
    "table": "public.attachments",
    "summary": "Metadata for files uploaded to Supabase Storage",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "original_name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Original filename as uploaded by user"
      },
      {
        "name": "storage_path",
        "type": "varchar(500)",
        "nullable": false,
        "description": "Path to file in Supabase Storage"
      },
      {
        "name": "size_bytes",
        "type": "integer",
        "nullable": false,
        "description": "File size in bytes"
      },
      {
        "name": "mime_type",
        "type": "varchar(100)",
        "nullable": false,
        "description": "MIME type of the file"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": false,
        "description": "User ID who uploaded the file"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the file was uploaded"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when metadata was last updated"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Optional description of the attachment"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_19364_1_not_null"
        },
        {
          "name": "2200_19364_2_not_null"
        },
        {
          "name": "2200_19364_3_not_null"
        },
        {
          "name": "2200_19364_4_not_null"
        },
        {
          "name": "2200_19364_5_not_null"
        },
        {
          "name": "2200_19364_6_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_attachments_created_by",
        "columns": [
          "created_by"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_attachments_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.audit_log",
    "summary": "Centralized audit log for tracking changes to invoices, payments, and related entities",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key"
      },
      {
        "name": "entity_type",
        "type": "text",
        "nullable": false,
        "description": "Type of entity: invoice, payment, invoice_attachment, payment_attachment, approval"
      },
      {
        "name": "entity_id",
        "type": "uuid",
        "nullable": false,
        "description": "ID of the affected entity"
      },
      {
        "name": "action",
        "type": "text",
        "nullable": false,
        "description": "Action performed: create, update, delete, file_add, file_delete, status_change, approval_action"
      },
      {
        "name": "field_name",
        "type": "text",
        "nullable": true,
        "description": "Name of the field that was changed (for update actions)"
      },
      {
        "name": "old_value",
        "type": "text",
        "nullable": true,
        "description": "Previous value (for update actions)"
      },
      {
        "name": "new_value",
        "type": "text",
        "nullable": true,
        "description": "New value (for update actions)"
      },
      {
        "name": "user_id",
        "type": "uuid",
        "nullable": false,
        "description": "User ID who performed the action"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the action was performed"
      },
      {
        "name": "metadata",
        "type": "jsonb",
        "nullable": true,
        "description": "Additional JSON metadata (file info, status names, comments)"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_26302_1_not_null"
        },
        {
          "name": "2200_26302_2_not_null"
        },
        {
          "name": "2200_26302_3_not_null"
        },
        {
          "name": "2200_26302_4_not_null"
        },
        {
          "name": "2200_26302_8_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_audit_log_action",
        "columns": [
          "action"
        ],
        "unique": false
      },
      {
        "name": "idx_audit_log_created_at",
        "columns": [
          "created_at DESC"
        ],
        "unique": false
      },
      {
        "name": "idx_audit_log_entity",
        "columns": [
          "entity_type",
          "entity_id"
        ],
        "unique": false
      },
      {
        "name": "idx_audit_log_user_id",
        "columns": [
          "user_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.contract_attachments",
    "summary": "Junction table linking contracts with attached files",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "uuid_generate_v4()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "contract_id",
        "type": "uuid",
        "nullable": false,
        "description": "Contract ID"
      },
      {
        "name": "attachment_id",
        "type": "uuid",
        "nullable": false,
        "description": "Attachment ID"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the link was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_21097_1_not_null"
        },
        {
          "name": "2200_21097_2_not_null"
        },
        {
          "name": "2200_21097_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_contract_attachments_attachment_id",
        "columns": [
          "attachment_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contract_attachments_contract_id",
        "columns": [
          "contract_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.contract_invoices",
    "summary": "Junction table linking contracts with invoices",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "uuid_generate_v4()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "contract_id",
        "type": "uuid",
        "nullable": false,
        "description": "Contract ID"
      },
      {
        "name": "invoice_id",
        "type": "uuid",
        "nullable": false,
        "description": "Invoice ID"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the link was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_21078_1_not_null"
        },
        {
          "name": "2200_21078_2_not_null"
        },
        {
          "name": "2200_21078_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_contract_invoices_contract_id",
        "columns": [
          "contract_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contract_invoices_invoice_id",
        "columns": [
          "invoice_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.contract_projects",
    "summary": "Many-to-many relationship table linking contracts with projects",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()"
      },
      {
        "name": "contract_id",
        "type": "uuid",
        "nullable": false,
        "description": "Reference to contract"
      },
      {
        "name": "project_id",
        "type": "integer",
        "nullable": false,
        "description": "Reference to project"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "contract_projects_unique",
          "columns": [
            "contract_id",
            "project_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_26920_1_not_null"
        },
        {
          "name": "2200_26920_2_not_null"
        },
        {
          "name": "2200_26920_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "contract_projects_unique",
        "columns": [
          "contract_id",
          "project_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contract_projects_contract_id",
        "columns": [
          "contract_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contract_projects_project_id",
        "columns": [
          "project_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.contract_statuses",
    "summary": "Contract status reference table",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('contract_statuses_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unique status code"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Status name"
      },
      {
        "name": "color",
        "type": "varchar(7)",
        "nullable": true,
        "description": "Display color for UI"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Status description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the status was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the status was last updated"
      },
      {
        "name": "sort_order",
        "type": "integer",
        "nullable": true,
        "default": "100",
        "description": "Sort order for display"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "contract_statuses_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_22407_1_not_null"
        },
        {
          "name": "2200_22407_2_not_null"
        },
        {
          "name": "2200_22407_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "contract_statuses_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "idx_contract_statuses_code",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "idx_contract_statuses_sort_order",
        "columns": [
          "sort_order"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_contract_statuses_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.contractors",
    "summary": "Registry of contractors linked to invoices and projects",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('contractors_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Official contractor name"
      },
      {
        "name": "inn",
        "type": "varchar(12)",
        "nullable": false,
        "description": "Russian tax identifier (INN)"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the contractor record"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the contractor was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the contractor was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "contractors_inn_key",
          "columns": [
            "inn"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_18404_1_not_null"
        },
        {
          "name": "2200_18404_3_not_null"
        },
        {
          "name": "2200_18404_4_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "contractors_inn_key",
        "columns": [
          "inn"
        ],
        "unique": false
      },
      {
        "name": "idx_contractors_inn",
        "columns": [
          "inn"
        ],
        "unique": false
      },
      {
        "name": "idx_contractors_updated_at",
        "columns": [
          "updated_at DESC"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_contractors_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.contracts",
    "summary": "Contracts with counterparties",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "uuid_generate_v4()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "contract_number",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Contract number"
      },
      {
        "name": "contract_date",
        "type": "date",
        "nullable": false,
        "description": "Contract signing date"
      },
      {
        "name": "payer_id",
        "type": "integer",
        "nullable": true,
        "description": "Payer contractor ID"
      },
      {
        "name": "supplier_id",
        "type": "integer",
        "nullable": true,
        "description": "Supplier contractor ID"
      },
      {
        "name": "vat_rate",
        "type": "numeric(5,2)",
        "nullable": true,
        "default": "20",
        "description": "VAT rate percentage"
      },
      {
        "name": "warranty_period_days",
        "type": "integer",
        "nullable": true,
        "description": "Warranty period in days"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Contract description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the contract was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the contract was last updated"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the contract"
      },
      {
        "name": "project_id",
        "type": "integer",
        "nullable": true,
        "description": "Project ID this contract belongs to"
      },
      {
        "name": "status_id",
        "type": "integer",
        "nullable": true,
        "description": "Contract status ID"
      },
      {
        "name": "payment_terms",
        "type": "text",
        "nullable": true,
        "description": "Payment terms (free text)"
      },
      {
        "name": "advance_percentage",
        "type": "numeric(5,2)",
        "nullable": true,
        "default": "0",
        "description": "Advance payment percentage (0-100)"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_21052_1_not_null"
        },
        {
          "name": "2200_21052_2_not_null"
        },
        {
          "name": "2200_21052_3_not_null"
        },
        {
          "name": "contracts_advance_percentage_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_contracts_contract_date",
        "columns": [
          "contract_date"
        ],
        "unique": false
      },
      {
        "name": "idx_contracts_contract_number",
        "columns": [
          "contract_number"
        ],
        "unique": false
      },
      {
        "name": "idx_contracts_payer_id",
        "columns": [
          "payer_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contracts_project_id",
        "columns": [
          "project_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contracts_status_id",
        "columns": [
          "status_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contracts_supplier_id",
        "columns": [
          "supplier_id"
        ],
        "unique": false
      },
      {
        "name": "idx_contracts_updated_at",
        "columns": [
          "updated_at DESC"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_contracts_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.departments",
    "summary": "Organizational departments",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('departments_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Department name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Department description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the department was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the department was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "departments_name_key",
          "columns": [
            "name"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_20791_1_not_null"
        },
        {
          "name": "2200_20791_2_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "departments_name_key",
        "columns": [
          "name"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_departments_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.employees",
    "summary": "Company employees registry",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('employees_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "last_name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Employee last name"
      },
      {
        "name": "first_name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Employee first name"
      },
      {
        "name": "middle_name",
        "type": "varchar(255)",
        "nullable": true,
        "description": "Employee middle name (patronymic)"
      },
      {
        "name": "full_name",
        "type": "varchar(765)",
        "nullable": true,
        "description": "Full name (auto-computed)"
      },
      {
        "name": "department_id",
        "type": "integer",
        "nullable": true,
        "description": "Department ID"
      },
      {
        "name": "position_id",
        "type": "integer",
        "nullable": true,
        "description": "Position ID"
      },
      {
        "name": "email",
        "type": "varchar(255)",
        "nullable": true,
        "description": "Employee email address"
      },
      {
        "name": "phone",
        "type": "varchar(50)",
        "nullable": true,
        "description": "Employee phone number"
      },
      {
        "name": "is_active",
        "type": "boolean",
        "nullable": false,
        "default": "true",
        "description": "Whether the employee is currently active"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the employee was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the employee was last updated"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the employee record"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_20817_10_not_null"
        },
        {
          "name": "2200_20817_1_not_null"
        },
        {
          "name": "2200_20817_2_not_null"
        },
        {
          "name": "2200_20817_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_employees_department_id",
        "columns": [
          "department_id"
        ],
        "unique": false
      },
      {
        "name": "idx_employees_full_name",
        "columns": [
          "full_name"
        ],
        "unique": false
      },
      {
        "name": "idx_employees_is_active",
        "columns": [
          "is_active"
        ],
        "unique": false
      },
      {
        "name": "idx_employees_position_id",
        "columns": [
          "position_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_employees_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.invoice_attachments",
    "summary": "Junction table linking invoices with attached files",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "invoice_id",
        "type": "uuid",
        "nullable": false,
        "description": "Invoice ID"
      },
      {
        "name": "attachment_id",
        "type": "uuid",
        "nullable": false,
        "description": "Attachment ID"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the link was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_19379_1_not_null"
        },
        {
          "name": "2200_19379_2_not_null"
        },
        {
          "name": "2200_19379_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_invoice_attachments_attachment_id",
        "columns": [
          "attachment_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoice_attachments_invoice_id",
        "columns": [
          "invoice_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "audit_invoice_attachments",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "DELETE"
        ],
        "function": "public.log_attachment_changes()"
      }
    ]
  },
  {
    "table": "public.invoice_payments",
    "summary": "Junction table linking invoices with payments and allocation amounts",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "invoice_id",
        "type": "uuid",
        "nullable": false,
        "description": "Invoice ID"
      },
      {
        "name": "payment_id",
        "type": "uuid",
        "nullable": false,
        "description": "Payment ID"
      },
      {
        "name": "allocated_amount",
        "type": "numeric(15,2)",
        "nullable": false,
        "description": "Amount of payment allocated to this invoice"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the allocation was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_19891_1_not_null"
        },
        {
          "name": "2200_19891_2_not_null"
        },
        {
          "name": "2200_19891_3_not_null"
        },
        {
          "name": "2200_19891_4_not_null"
        },
        {
          "name": "positive_allocated_amount"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_invoice_payments_invoice_id",
        "columns": [
          "invoice_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoice_payments_payment_id",
        "columns": [
          "payment_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_delivery_date_on_payment_change",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "DELETE",
          "UPDATE"
        ],
        "function": "public.recalculate_invoice_delivery_date()"
      }
    ]
  },
  {
    "table": "public.invoice_statuses",
    "summary": "Invoice status reference table",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('invoice_statuses_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unique status code"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Status name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Status description"
      },
      {
        "name": "sort_order",
        "type": "integer",
        "nullable": true,
        "description": "Sort order for display"
      },
      {
        "name": "color",
        "type": "varchar(20)",
        "nullable": true,
        "description": "Display color for UI"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the status was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the status was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "invoice_statuses_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_19183_1_not_null"
        },
        {
          "name": "2200_19183_2_not_null"
        },
        {
          "name": "2200_19183_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_invoice_statuses_code",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "idx_invoice_statuses_sort_order",
        "columns": [
          "sort_order"
        ],
        "unique": false
      },
      {
        "name": "invoice_statuses_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_invoice_statuses_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.invoice_types",
    "summary": "Invoice type reference table",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('invoice_types_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unique type code"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Invoice type name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Invoice type description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the type was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the type was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "invoice_types_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_18911_1_not_null"
        },
        {
          "name": "2200_18911_2_not_null"
        },
        {
          "name": "2200_18911_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_invoice_types_code",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "invoice_types_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_invoice_types_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.invoices",
    "summary": "Outbound invoices issued to contractors",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "uuid_generate_v4()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "user_id",
        "type": "uuid",
        "nullable": false,
        "description": "Supabase auth user who created the invoice"
      },
      {
        "name": "invoice_number",
        "type": "text",
        "nullable": false,
        "description": "Human-readable invoice number"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Invoice description"
      },
      {
        "name": "due_date",
        "type": "date",
        "nullable": true,
        "description": "Payment due date (deprecated)"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the invoice was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the invoice was last updated"
      },
      {
        "name": "invoice_date",
        "type": "date",
        "nullable": false,
        "default": "CURRENT_DATE",
        "description": "Invoice issue date"
      },
      {
        "name": "payer_id",
        "type": "integer",
        "nullable": true,
        "description": "Contractor acting as payer"
      },
      {
        "name": "supplier_id",
        "type": "integer",
        "nullable": true,
        "description": "Contractor acting as supplier"
      },
      {
        "name": "project_id",
        "type": "integer",
        "nullable": true,
        "description": "Project this invoice belongs to"
      },
      {
        "name": "invoice_type_id",
        "type": "integer",
        "nullable": true,
        "description": "Invoice type"
      },
      {
        "name": "amount_with_vat",
        "type": "numeric(15,2)",
        "nullable": true,
        "description": "Total amount including VAT"
      },
      {
        "name": "vat_rate",
        "type": "numeric(5,2)",
        "nullable": true,
        "default": "20",
        "description": "VAT rate percentage"
      },
      {
        "name": "vat_amount",
        "type": "numeric(15,2)",
        "nullable": true,
        "description": "VAT amount (calculated)"
      },
      {
        "name": "amount_without_vat",
        "type": "numeric(15,2)",
        "nullable": true,
        "description": "Amount excluding VAT (calculated)"
      },
      {
        "name": "delivery_days",
        "type": "integer",
        "nullable": true,
        "description": "Number of days for delivery"
      },
      {
        "name": "delivery_days_type",
        "type": "varchar(20)",
        "nullable": true,
        "default": "'working'::character varying",
        "description": "Type of days: working or calendar"
      },
      {
        "name": "preliminary_delivery_date",
        "type": "date",
        "nullable": true,
        "description": "Preliminary delivery date"
      },
      {
        "name": "status_id",
        "type": "integer",
        "nullable": false,
        "description": "Invoice status"
      },
      {
        "name": "delivery_cost",
        "type": "numeric(12,2)",
        "nullable": true,
        "default": "0",
        "description": "Delivery cost"
      },
      {
        "name": "relevance_date",
        "type": "date",
        "nullable": false,
        "default": "CURRENT_TIMESTAMP",
        "description": "Invoice relevance/validity date"
      },
      {
        "name": "material_request_id",
        "type": "uuid",
        "nullable": true,
        "description": "Material request this invoice is linked to"
      },
      {
        "name": "contract_id",
        "type": "uuid",
        "nullable": true,
        "description": "Contract this invoice is linked to"
      },
      {
        "name": "responsible_id",
        "type": "uuid",
        "nullable": true,
        "description": "Responsible procurement manager (user_profiles UUID)"
      },
      {
        "name": "is_archived",
        "type": "boolean",
        "nullable": false,
        "default": "false",
        "description": "Whether the invoice is archived"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_18252_10_not_null"
        },
        {
          "name": "2200_18252_1_not_null"
        },
        {
          "name": "2200_18252_22_not_null"
        },
        {
          "name": "2200_18252_24_not_null"
        },
        {
          "name": "2200_18252_29_not_null"
        },
        {
          "name": "2200_18252_2_not_null"
        },
        {
          "name": "2200_18252_3_not_null"
        },
        {
          "name": "invoices_delivery_days_type_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_invoices_contract_id",
        "columns": [
          "contract_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_created_at",
        "columns": [
          "created_at DESC"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_invoice_date",
        "columns": [
          "invoice_date"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_invoice_type_id",
        "columns": [
          "invoice_type_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_is_archived",
        "columns": [
          "is_archived"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_material_request",
        "columns": [
          "material_request_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_material_request_id",
        "columns": [
          "material_request_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_payer_id",
        "columns": [
          "payer_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_project_id",
        "columns": [
          "project_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_responsible_id",
        "columns": [
          "responsible_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_status_id",
        "columns": [
          "status_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_supplier_id",
        "columns": [
          "supplier_id"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_updated_at",
        "columns": [
          "updated_at DESC"
        ],
        "unique": false
      },
      {
        "name": "idx_invoices_user_id",
        "columns": [
          "user_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "audit_invoice_changes",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "DELETE",
          "UPDATE"
        ],
        "function": "public.log_invoice_changes()"
      },
      {
        "trigger": "update_invoices_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.letter_attachments",
    "summary": "Связь писем с прикрепленными файлами",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()"
      },
      {
        "name": "letter_id",
        "type": "uuid",
        "nullable": false
      },
      {
        "name": "attachment_id",
        "type": "uuid",
        "nullable": false
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "letter_attachments_letter_id_attachment_id_key",
          "columns": [
            "attachment_id",
            "letter_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_27206_1_not_null"
        },
        {
          "name": "2200_27206_2_not_null"
        },
        {
          "name": "2200_27206_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_letter_attachments_attachment_id",
        "columns": [
          "attachment_id"
        ],
        "unique": false
      },
      {
        "name": "idx_letter_attachments_letter_id",
        "columns": [
          "letter_id"
        ],
        "unique": false
      },
      {
        "name": "letter_attachments_letter_id_attachment_id_key",
        "columns": [
          "letter_id",
          "attachment_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.letter_links",
    "summary": "Связи между письмами (родительское письмо и его ответы/связанные письма)",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()"
      },
      {
        "name": "parent_id",
        "type": "uuid",
        "nullable": false
      },
      {
        "name": "child_id",
        "type": "uuid",
        "nullable": false
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "letter_links_parent_id_child_id_key",
          "columns": [
            "child_id",
            "parent_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_27227_1_not_null"
        },
        {
          "name": "2200_27227_2_not_null"
        },
        {
          "name": "2200_27227_3_not_null"
        },
        {
          "name": "letter_links_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_letter_links_child_id",
        "columns": [
          "child_id"
        ],
        "unique": false
      },
      {
        "name": "idx_letter_links_parent_id",
        "columns": [
          "parent_id"
        ],
        "unique": false
      },
      {
        "name": "letter_links_parent_id_child_id_key",
        "columns": [
          "parent_id",
          "child_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.letter_statuses",
    "summary": "Статусы писем (новое, на рассмотрении, исполнено, архив и т.д.)",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('letter_statuses_id_seq'::regclass)"
      },
      {
        "name": "name",
        "type": "text",
        "nullable": false
      },
      {
        "name": "code",
        "type": "text",
        "nullable": false
      },
      {
        "name": "color",
        "type": "text",
        "nullable": true
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "letter_statuses_code_key",
          "columns": [
            "code"
          ]
        },
        {
          "name": "letter_statuses_name_key",
          "columns": [
            "name"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_27153_1_not_null"
        },
        {
          "name": "2200_27153_2_not_null"
        },
        {
          "name": "2200_27153_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "letter_statuses_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "letter_statuses_name_key",
        "columns": [
          "name"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.letters",
    "summary": "Учет входящих и исходящих писем компании",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()"
      },
      {
        "name": "project_id",
        "type": "bigint",
        "nullable": true,
        "description": "Связанный проект"
      },
      {
        "name": "number",
        "type": "text",
        "nullable": true,
        "description": "Номер письма (необязательное поле)"
      },
      {
        "name": "status_id",
        "type": "integer",
        "nullable": true,
        "default": "1",
        "description": "Текущий статус письма"
      },
      {
        "name": "letter_date",
        "type": "date",
        "nullable": false,
        "description": "Дата письма"
      },
      {
        "name": "subject",
        "type": "text",
        "nullable": true,
        "description": "Тема/предмет письма"
      },
      {
        "name": "content",
        "type": "text",
        "nullable": true,
        "description": "Краткое содержание письма"
      },
      {
        "name": "responsible_user_id",
        "type": "uuid",
        "nullable": true,
        "description": "Ответственный за обработку письма (ссылка на зарегистрированного пользователя)"
      },
      {
        "name": "sender",
        "type": "text",
        "nullable": true,
        "description": "Отправитель письма (текст для физ.лица, используется когда sender_type = individual)"
      },
      {
        "name": "recipient",
        "type": "text",
        "nullable": true,
        "description": "Получатель письма (текст для физ.лица, используется когда recipient_type = individual)"
      },
      {
        "name": "direction",
        "type": "text",
        "nullable": false,
        "default": "'incoming'::text",
        "description": "Направление: incoming (входящее) или outgoing (исходящее)"
      },
      {
        "name": "reg_number",
        "type": "text",
        "nullable": true,
        "description": "Регистрационный номер (необязательное поле)"
      },
      {
        "name": "reg_date",
        "type": "date",
        "nullable": true,
        "description": "Дата регистрации в системе"
      },
      {
        "name": "delivery_method",
        "type": "text",
        "nullable": true,
        "description": "Способ доставки/отправки письма (почта, email, курьер, ЭДО, факс, другое)"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "Пользователь, создавший запись"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()"
      },
      {
        "name": "responsible_person_name",
        "type": "text",
        "nullable": true,
        "description": "Ответственный за обработку письма (произвольное текстовое поле для физических лиц)"
      },
      {
        "name": "response_deadline",
        "type": "date",
        "nullable": true,
        "description": "Регламентный срок ответа на письмо"
      },
      {
        "name": "sender_type",
        "type": "text",
        "nullable": true,
        "default": "'individual'::text",
        "description": "Type of sender: individual (физ.лицо) or contractor (контрагент)"
      },
      {
        "name": "sender_contractor_id",
        "type": "integer",
        "nullable": true,
        "description": "Reference to contractor if sender_type = contractor"
      },
      {
        "name": "recipient_type",
        "type": "text",
        "nullable": true,
        "default": "'individual'::text",
        "description": "Type of recipient: individual (физ.лицо) or contractor (контрагент)"
      },
      {
        "name": "recipient_contractor_id",
        "type": "integer",
        "nullable": true,
        "description": "Reference to contractor if recipient_type = contractor"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_27166_11_not_null"
        },
        {
          "name": "2200_27166_1_not_null"
        },
        {
          "name": "2200_27166_5_not_null"
        },
        {
          "name": "letters_direction_check"
        },
        {
          "name": "letters_recipient_type_check"
        },
        {
          "name": "letters_sender_type_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_letters_created_at",
        "columns": [
          "created_at"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_direction",
        "columns": [
          "direction"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_letter_date",
        "columns": [
          "letter_date"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_project_id",
        "columns": [
          "project_id"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_recipient_contractor_id",
        "columns": [
          "recipient_contractor_id"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_recipient_type",
        "columns": [
          "recipient_type"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_reg_date",
        "columns": [
          "reg_date"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_responsible_user_id",
        "columns": [
          "responsible_user_id"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_sender_contractor_id",
        "columns": [
          "sender_contractor_id"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_sender_type",
        "columns": [
          "sender_type"
        ],
        "unique": false
      },
      {
        "name": "idx_letters_status_id",
        "columns": [
          "status_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_letters_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.material_classes",
    "summary": "Material classification hierarchy",
    "columns": [
      {
        "name": "id",
        "type": "bigint",
        "nullable": false,
        "pk": true,
        "description": "Primary key"
      },
      {
        "name": "name",
        "type": "text",
        "nullable": false,
        "description": "Class name"
      },
      {
        "name": "is_active",
        "type": "boolean",
        "nullable": true,
        "default": "true",
        "description": "Whether the class is currently active"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "CURRENT_TIMESTAMP",
        "description": "Timestamp when the class was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "CURRENT_TIMESTAMP",
        "description": "Timestamp when the class was last updated"
      },
      {
        "name": "parent_id",
        "type": "bigint",
        "nullable": true,
        "description": "Parent class ID (for hierarchical structure)"
      },
      {
        "name": "level",
        "type": "integer",
        "nullable": true,
        "default": "0",
        "description": "Hierarchy level (depth in tree)"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "material_classes_name_parent_key",
          "columns": [
            "name",
            "parent_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_21264_1_not_null"
        },
        {
          "name": "2200_21264_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_material_classes_is_active",
        "columns": [
          "is_active"
        ],
        "unique": false
      },
      {
        "name": "idx_material_classes_level",
        "columns": [
          "level"
        ],
        "unique": false
      },
      {
        "name": "idx_material_classes_parent",
        "columns": [
          "parent_id"
        ],
        "unique": false
      },
      {
        "name": "idx_material_classes_parent_active",
        "columns": [
          "parent_id",
          "is_active"
        ],
        "unique": false
      },
      {
        "name": "material_classes_name_parent_key",
        "columns": [
          "name",
          "parent_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_material_classes_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.material_nomenclature",
    "summary": "Material catalog and specifications",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('material_nomenclature_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "name",
        "type": "varchar(500)",
        "nullable": false,
        "description": "Material name"
      },
      {
        "name": "unit",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unit of measurement"
      },
      {
        "name": "is_active",
        "type": "boolean",
        "nullable": true,
        "default": "true",
        "description": "Whether the material is currently active"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the material was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the material was last updated"
      },
      {
        "name": "material_class_id",
        "type": "integer",
        "nullable": true,
        "description": "Material class ID"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_23111_1_not_null"
        },
        {
          "name": "2200_23111_2_not_null"
        },
        {
          "name": "2200_23111_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_material_nomenclature_active",
        "columns": [
          "is_active"
        ],
        "unique": false
      },
      {
        "name": "idx_material_nomenclature_class",
        "columns": [
          "material_class_id"
        ],
        "unique": false
      },
      {
        "name": "idx_material_nomenclature_name",
        "columns": [
          "name"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_material_nomenclature_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.material_request_items",
    "summary": "Individual items within material requests",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key"
      },
      {
        "name": "material_request_id",
        "type": "uuid",
        "nullable": false,
        "description": "Material request ID this item belongs to"
      },
      {
        "name": "material_name",
        "type": "varchar(500)",
        "nullable": false,
        "description": "Material name"
      },
      {
        "name": "unit",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unit of measurement"
      },
      {
        "name": "quantity",
        "type": "numeric(15,3)",
        "nullable": false,
        "description": "Requested quantity"
      },
      {
        "name": "sort_order",
        "type": "integer",
        "nullable": true,
        "default": "0",
        "description": "Sort order for display"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the item was created"
      },
      {
        "name": "nomenclature_id",
        "type": "integer",
        "nullable": true,
        "description": "Material nomenclature ID (optional link)"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_21636_1_not_null"
        },
        {
          "name": "2200_21636_2_not_null"
        },
        {
          "name": "2200_21636_3_not_null"
        },
        {
          "name": "2200_21636_4_not_null"
        },
        {
          "name": "2200_21636_5_not_null"
        },
        {
          "name": "material_request_items_quantity_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_material_request_items_nomenclature",
        "columns": [
          "nomenclature_id"
        ],
        "unique": false
      },
      {
        "name": "idx_material_request_items_request",
        "columns": [
          "material_request_id"
        ],
        "unique": false
      },
      {
        "name": "idx_material_request_items_sort",
        "columns": [
          "sort_order"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_material_request_items_count_trigger",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "DELETE"
        ],
        "function": "public.update_material_request_items_count()"
      }
    ]
  },
  {
    "table": "public.material_requests",
    "summary": "Material requisitions submitted by employees",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "request_number",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Human-readable request number"
      },
      {
        "name": "request_date",
        "type": "date",
        "nullable": false,
        "default": "CURRENT_DATE",
        "description": "Date when the request was submitted"
      },
      {
        "name": "project_id",
        "type": "integer",
        "nullable": true,
        "description": "Project this request belongs to"
      },
      {
        "name": "employee_id",
        "type": "integer",
        "nullable": true,
        "description": "Employee who submitted the request"
      },
      {
        "name": "total_items",
        "type": "integer",
        "nullable": true,
        "default": "0",
        "description": "Total number of items (auto-counted)"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the request"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the request was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the request was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_21608_1_not_null"
        },
        {
          "name": "2200_21608_2_not_null"
        },
        {
          "name": "2200_21608_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_material_requests_date",
        "columns": [
          "request_date"
        ],
        "unique": false
      },
      {
        "name": "idx_material_requests_employee",
        "columns": [
          "employee_id"
        ],
        "unique": false
      },
      {
        "name": "idx_material_requests_project",
        "columns": [
          "project_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_material_requests_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.payment_approvals",
    "summary": "Payment approval instances tracking approval workflow progress",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "payment_id",
        "type": "uuid",
        "nullable": false,
        "description": "Payment ID being approved"
      },
      {
        "name": "route_id",
        "type": "integer",
        "nullable": false,
        "description": "Approval route ID being used"
      },
      {
        "name": "status_id",
        "type": "integer",
        "nullable": false,
        "description": "Current approval status ID"
      },
      {
        "name": "current_stage_index",
        "type": "integer",
        "nullable": false,
        "default": "0",
        "description": "Index of current workflow stage (0-based)"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the approval was initiated"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the approval was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_20117_1_not_null"
        },
        {
          "name": "2200_20117_2_not_null"
        },
        {
          "name": "2200_20117_3_not_null"
        },
        {
          "name": "2200_20117_4_not_null"
        },
        {
          "name": "2200_20117_5_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_payment_approvals_payment",
        "columns": [
          "payment_id"
        ],
        "unique": false
      },
      {
        "name": "idx_payment_approvals_status",
        "columns": [
          "status_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_payment_approvals_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.payment_attachments",
    "summary": "Junction table linking payments with attached files",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "payment_id",
        "type": "uuid",
        "nullable": false,
        "description": "Payment ID"
      },
      {
        "name": "attachment_id",
        "type": "uuid",
        "nullable": false,
        "description": "Attachment ID"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the link was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_19998_1_not_null"
        },
        {
          "name": "2200_19998_2_not_null"
        },
        {
          "name": "2200_19998_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_payment_attachments_attachment_id",
        "columns": [
          "attachment_id"
        ],
        "unique": false
      },
      {
        "name": "idx_payment_attachments_payment_id",
        "columns": [
          "payment_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "audit_payment_attachments",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "DELETE"
        ],
        "function": "public.log_attachment_changes()"
      }
    ]
  },
  {
    "table": "public.payment_statuses",
    "summary": "Payment status reference table",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('payment_statuses_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unique status code"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Status name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Status description"
      },
      {
        "name": "sort_order",
        "type": "integer",
        "nullable": true,
        "description": "Sort order for display"
      },
      {
        "name": "color",
        "type": "varchar(20)",
        "nullable": true,
        "description": "Display color for UI"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the status was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the status was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "payment_statuses_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_19825_1_not_null"
        },
        {
          "name": "2200_19825_2_not_null"
        },
        {
          "name": "2200_19825_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "payment_statuses_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_payment_statuses_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.payment_types",
    "summary": "Payment type reference table",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('payment_types_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unique type code"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Payment type name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Payment type description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the type was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the type was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "payment_types_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_19838_1_not_null"
        },
        {
          "name": "2200_19838_2_not_null"
        },
        {
          "name": "2200_19838_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "payment_types_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_payment_types_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.payments",
    "summary": "Payment records for invoices",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "default": "gen_random_uuid()",
        "description": "Primary key (UUID)"
      },
      {
        "name": "invoice_id",
        "type": "uuid",
        "nullable": false,
        "description": "Primary invoice this payment is for"
      },
      {
        "name": "payment_number",
        "type": "integer",
        "nullable": false,
        "default": "nextval('payment_number_seq'::regclass)",
        "description": "Sequential payment number"
      },
      {
        "name": "payment_date",
        "type": "date",
        "nullable": false,
        "default": "CURRENT_DATE",
        "description": "Payment date"
      },
      {
        "name": "amount",
        "type": "numeric(15,2)",
        "nullable": false,
        "description": "Total payment amount"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Payment description or notes"
      },
      {
        "name": "payment_type_id",
        "type": "integer",
        "nullable": true,
        "description": "Payment type"
      },
      {
        "name": "status_id",
        "type": "integer",
        "nullable": true,
        "default": "1",
        "description": "Payment status"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the payment"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the payment was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the payment was last updated"
      },
      {
        "name": "is_archived",
        "type": "boolean",
        "nullable": false,
        "default": "false",
        "description": "Whether the payment is archived"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "payments_payment_number_key",
          "columns": [
            "payment_number"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_19851_12_not_null"
        },
        {
          "name": "2200_19851_1_not_null"
        },
        {
          "name": "2200_19851_2_not_null"
        },
        {
          "name": "2200_19851_3_not_null"
        },
        {
          "name": "2200_19851_4_not_null"
        },
        {
          "name": "2200_19851_5_not_null"
        },
        {
          "name": "positive_amount"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_payments_created_by",
        "columns": [
          "created_by"
        ],
        "unique": false
      },
      {
        "name": "idx_payments_invoice_id",
        "columns": [
          "invoice_id"
        ],
        "unique": false
      },
      {
        "name": "idx_payments_is_archived",
        "columns": [
          "is_archived"
        ],
        "unique": false
      },
      {
        "name": "idx_payments_payment_date",
        "columns": [
          "payment_date"
        ],
        "unique": false
      },
      {
        "name": "idx_payments_status_id",
        "columns": [
          "status_id"
        ],
        "unique": false
      },
      {
        "name": "idx_payments_updated_at",
        "columns": [
          "updated_at DESC"
        ],
        "unique": false
      },
      {
        "name": "payments_payment_number_key",
        "columns": [
          "payment_number"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "audit_payment_changes",
        "timing": "AFTER",
        "events": [
          "INSERT",
          "DELETE",
          "UPDATE"
        ],
        "function": "public.log_payment_changes()"
      },
      {
        "trigger": "update_payments_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.positions",
    "summary": "Employee positions/job titles",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('positions_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Position name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Position description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the position was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the position was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "positions_name_key",
          "columns": [
            "name"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_20804_1_not_null"
        },
        {
          "name": "2200_20804_2_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "positions_name_key",
        "columns": [
          "name"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_positions_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.project_budgets",
    "summary": "Project budgets and financial allocations",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('project_budgets_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "project_id",
        "type": "integer",
        "nullable": false,
        "description": "Project ID"
      },
      {
        "name": "allocated_amount",
        "type": "numeric(15,2)",
        "nullable": false,
        "default": "0",
        "description": "Total allocated budget amount"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Budget description or notes"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the budget record"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the budget was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the budget was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [],
      "checks": [
        {
          "name": "2200_26027_1_not_null"
        },
        {
          "name": "2200_26027_2_not_null"
        },
        {
          "name": "2200_26027_3_not_null"
        },
        {
          "name": "project_budgets_allocated_amount_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_project_budgets_created_by",
        "columns": [
          "created_by"
        ],
        "unique": false
      },
      {
        "name": "idx_project_budgets_project_id",
        "columns": [
          "project_id"
        ],
        "unique": false
      },
      {
        "name": "project_budgets_project_id_key",
        "columns": [
          "project_id"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_project_budgets_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.projects",
    "summary": "Company projects",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('projects_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": true,
        "description": "Project code/identifier"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Project name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Project description"
      },
      {
        "name": "is_active",
        "type": "boolean",
        "nullable": true,
        "default": "true",
        "description": "Whether the project is currently active"
      },
      {
        "name": "created_by",
        "type": "uuid",
        "nullable": true,
        "description": "User ID who created the project"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the project was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the project was last updated"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "projects_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_18372_1_not_null"
        },
        {
          "name": "2200_18372_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_projects_code",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "idx_projects_is_active",
        "columns": [
          "is_active"
        ],
        "unique": false
      },
      {
        "name": "projects_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_projects_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.roles",
    "summary": "User roles with page-level permissions",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('roles_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "code",
        "type": "varchar(50)",
        "nullable": false,
        "description": "Unique role code"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": false,
        "description": "Role name"
      },
      {
        "name": "description",
        "type": "text",
        "nullable": true,
        "description": "Role description"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the role was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the role was last updated"
      },
      {
        "name": "own_projects_only",
        "type": "boolean",
        "nullable": true,
        "default": "false",
        "description": "Whether user can only see their own projects"
      },
      {
        "name": "allowed_pages",
        "type": "jsonb",
        "nullable": true,
        "description": "JSON array of allowed page routes"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "roles_code_key",
          "columns": [
            "code"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_18359_1_not_null"
        },
        {
          "name": "2200_18359_2_not_null"
        },
        {
          "name": "2200_18359_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_roles_allowed_pages",
        "columns": [
          "allowed_pages"
        ],
        "unique": false
      },
      {
        "name": "idx_roles_code",
        "columns": [
          "code"
        ],
        "unique": false
      },
      {
        "name": "roles_code_key",
        "columns": [
          "code"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_roles_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.user_profiles",
    "summary": "Extended user profiles linked to Supabase auth users",
    "columns": [
      {
        "name": "id",
        "type": "uuid",
        "nullable": false,
        "pk": true,
        "fk": "auth.users.id",
        "description": "Primary key (matches auth.users.id)"
      },
      {
        "name": "email",
        "type": "text",
        "nullable": false,
        "description": "User email address"
      },
      {
        "name": "full_name",
        "type": "text",
        "nullable": false,
        "description": "User full name"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the profile was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the profile was last updated"
      },
      {
        "name": "role_id",
        "type": "integer",
        "nullable": true,
        "description": "User role ID for approval workflow"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [
        {
          "column": "id",
          "references": "auth.users.id",
          "description": "Primary key (matches auth.users.id)"
        }
      ],
      "unique": [
        {
          "name": "user_profiles_email_key",
          "columns": [
            "email"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_18236_1_not_null"
        },
        {
          "name": "2200_18236_2_not_null"
        },
        {
          "name": "2200_18236_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "user_profiles_email_key",
        "columns": [
          "email"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_user_profiles_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  },
  {
    "table": "public.user_projects",
    "summary": "Junction table linking users with projects they have access to",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "default": "nextval('user_projects_id_seq'::regclass)",
        "description": "Primary key"
      },
      {
        "name": "user_id",
        "type": "uuid",
        "nullable": false,
        "description": "User ID"
      },
      {
        "name": "project_id",
        "type": "integer",
        "nullable": false,
        "description": "Project ID"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the link was created"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "user_projects_user_project_unique",
          "columns": [
            "project_id",
            "user_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_18517_1_not_null"
        },
        {
          "name": "2200_18517_2_not_null"
        },
        {
          "name": "2200_18517_3_not_null"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_user_projects_project_id",
        "columns": [
          "project_id"
        ],
        "unique": false
      },
      {
        "name": "idx_user_projects_user_id",
        "columns": [
          "user_id"
        ],
        "unique": false
      },
      {
        "name": "user_projects_user_project_unique",
        "columns": [
          "user_id",
          "project_id"
        ],
        "unique": false
      }
    ],
    "triggers": []
  },
  {
    "table": "public.workflow_stages",
    "summary": "Workflow stages for approval routes",
    "columns": [
      {
        "name": "id",
        "type": "integer",
        "nullable": false,
        "pk": true,
        "description": "Primary key"
      },
      {
        "name": "route_id",
        "type": "integer",
        "nullable": false,
        "description": "Approval route ID this stage belongs to"
      },
      {
        "name": "order_index",
        "type": "integer",
        "nullable": false,
        "description": "Stage order index (0-based)"
      },
      {
        "name": "role_id",
        "type": "integer",
        "nullable": false,
        "description": "Role ID required for this stage"
      },
      {
        "name": "name",
        "type": "varchar(255)",
        "nullable": true,
        "description": "Stage name"
      },
      {
        "name": "created_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the stage was created"
      },
      {
        "name": "updated_at",
        "type": "timestamptz",
        "nullable": true,
        "default": "now()",
        "description": "Timestamp when the stage was last updated"
      },
      {
        "name": "payment_status_id",
        "type": "integer",
        "nullable": true,
        "description": "Payment status to set when this stage is reached"
      },
      {
        "name": "permissions",
        "type": "jsonb",
        "nullable": true,
        "default": "'{}'::jsonb",
        "description": "JSON permissions object for this stage"
      },
      {
        "name": "is_active",
        "type": "boolean",
        "nullable": true,
        "default": "true",
        "description": "Whether this stage is currently active"
      }
    ],
    "constraints": {
      "primary_key": [
        "id"
      ],
      "foreign_keys": [],
      "unique": [
        {
          "name": "workflow_stages_route_id_order_index_key",
          "columns": [
            "order_index",
            "route_id"
          ]
        }
      ],
      "checks": [
        {
          "name": "2200_20097_1_not_null"
        },
        {
          "name": "2200_20097_2_not_null"
        },
        {
          "name": "2200_20097_3_not_null"
        },
        {
          "name": "2200_20097_4_not_null"
        },
        {
          "name": "workflow_stages_order_index_check"
        }
      ]
    },
    "indexes": [
      {
        "name": "idx_workflow_stages_is_active",
        "columns": [
          "is_active"
        ],
        "unique": false
      },
      {
        "name": "idx_workflow_stages_payment_status",
        "columns": [
          "payment_status_id"
        ],
        "unique": false
      },
      {
        "name": "idx_workflow_stages_permissions",
        "columns": [
          "permissions"
        ],
        "unique": false
      },
      {
        "name": "idx_workflow_stages_role",
        "columns": [
          "role_id"
        ],
        "unique": false
      },
      {
        "name": "idx_workflow_stages_route",
        "columns": [
          "route_id"
        ],
        "unique": false
      },
      {
        "name": "workflow_stages_route_id_order_index_key",
        "columns": [
          "route_id",
          "order_index"
        ],
        "unique": false
      }
    ],
    "triggers": [
      {
        "trigger": "update_workflow_stages_updated_at",
        "timing": "BEFORE",
        "events": [
          "UPDATE"
        ],
        "function": "public.update_updated_at_column()"
      }
    ]
  }
]
